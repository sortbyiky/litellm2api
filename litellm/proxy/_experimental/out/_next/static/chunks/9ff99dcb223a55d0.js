(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,910119,e=>{"use strict";var s=e.i(843476),l=e.i(197647),t=e.i(653824),a=e.i(881073),r=e.i(404206),i=e.i(723731),n=e.i(271645);e.i(785269);var d=e.i(322831),o=e.i(994388),c=e.i(212931),u=e.i(898586),m=e.i(312361),x=e.i(998573),h=e.i(291542),g=e.i(199133),p=e.i(28651),j=e.i(175712),f=e.i(770914),y=e.i(536916),b=e.i(764205),_=e.i(827252),v=e.i(35983),N=e.i(779241),S=e.i(78085),T=e.i(808613),w=e.i(592968),C=e.i(708347),k=e.i(860585),I=e.i(355619),U=e.i(435451);function B({userData:e,onCancel:l,onSubmit:t,teams:a,accessToken:r,userID:i,userRole:d,userModels:c,possibleUIRoles:u,isBulkEdit:m=!1}){let[x]=T.Form.useForm(),[h,p]=(0,n.useState)(!1);return n.default.useEffect(()=>{let s=e.user_info?.max_budget,l=null==s;p(l),x.setFieldsValue({user_id:e.user_id,user_email:e.user_info?.user_email,user_alias:e.user_info?.user_alias,user_role:e.user_info?.user_role,models:e.user_info?.models||[],max_budget:l?"":s,budget_duration:e.user_info?.budget_duration,metadata:e.user_info?.metadata?JSON.stringify(e.user_info.metadata,null,2):void 0})},[e,x]),(0,s.jsxs)(T.Form,{form:x,onFinish:e=>{if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(e){console.error("Error parsing metadata JSON:",e);return}(h||""===e.max_budget||void 0===e.max_budget)&&(e.max_budget=null),t(e)},layout:"vertical",children:[!m&&(0,s.jsx)(T.Form.Item,{label:"User ID",name:"user_id",children:(0,s.jsx)(N.TextInput,{disabled:!0})}),!m&&(0,s.jsx)(T.Form.Item,{label:"Email",name:"user_email",children:(0,s.jsx)(N.TextInput,{})}),(0,s.jsx)(T.Form.Item,{label:"User Alias",name:"user_alias",children:(0,s.jsx)(N.TextInput,{})}),(0,s.jsx)(T.Form.Item,{label:(0,s.jsxs)("span",{children:["Global Proxy Role"," ",(0,s.jsx)(w.Tooltip,{title:"This is the role that the user will globally on the proxy. This role is independent of any team/org specific roles.",children:(0,s.jsx)(_.InfoCircleOutlined,{})})]}),name:"user_role",children:(0,s.jsx)(g.Select,{children:u&&Object.entries(u).map(([e,{ui_label:l,description:t}])=>(0,s.jsx)(v.SelectItem,{value:e,title:l,children:(0,s.jsxs)("div",{className:"flex",children:[l," ",(0,s.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:t})]})},e))})}),(0,s.jsx)(T.Form.Item,{label:(0,s.jsxs)("span",{children:["Personal Models"," ",(0,s.jsx)(w.Tooltip,{title:"Select which models this user can access outside of team-scope. Choose 'All Proxy Models' to grant access to all models available on the proxy.",children:(0,s.jsx)(_.InfoCircleOutlined,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,s.jsxs)(g.Select,{mode:"multiple",placeholder:"Select models",style:{width:"100%"},disabled:!C.all_admin_roles.includes(d||""),children:[(0,s.jsx)(g.Select.Option,{value:"all-proxy-models",children:"All Proxy Models"},"all-proxy-models"),(0,s.jsx)(g.Select.Option,{value:"no-default-models",children:"No Default Models"},"no-default-models"),c.map(e=>(0,s.jsx)(g.Select.Option,{value:e,children:(0,I.getModelDisplayName)(e)},e))]})}),(0,s.jsx)(T.Form.Item,{label:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,s.jsx)("span",{children:"Max Budget (USD)"}),(0,s.jsx)(y.Checkbox,{checked:h,onChange:e=>{let s=e.target.checked;p(s),s&&x.setFieldsValue({max_budget:""})},children:"Unlimited Budget"})]}),name:"max_budget",rules:[{validator:(e,s)=>h||""!==s&&null!=s?Promise.resolve():Promise.reject(Error("Please enter a budget or select Unlimited Budget"))}],children:(0,s.jsx)(U.default,{step:.01,precision:2,style:{width:"100%"},disabled:h})}),(0,s.jsx)(T.Form.Item,{label:"Reset Budget",name:"budget_duration",children:(0,s.jsx)(k.default,{})}),(0,s.jsx)(T.Form.Item,{label:"Metadata",name:"metadata",children:(0,s.jsx)(S.Textarea,{rows:4,placeholder:"Enter metadata as JSON"})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(o.Button,{variant:"secondary",type:"button",onClick:l,children:"Cancel"}),(0,s.jsx)(o.Button,{type:"submit",children:"Save Changes"})]})]})}var D=e.i(727749);let{Text:F,Title:A}=u.Typography,R=({open:e,onCancel:l,selectedUsers:t,possibleUIRoles:a,accessToken:r,onSuccess:i,teams:d,userRole:o,userModels:u,allowAllUsers:_=!1})=>{let[v,N]=(0,n.useState)(!1),[S,T]=(0,n.useState)([]),[w,C]=(0,n.useState)(null),[k,I]=(0,n.useState)(!1),[U,R]=(0,n.useState)(!1),L=()=>{T([]),C(null),I(!1),R(!1),l()},E=n.default.useMemo(()=>({user_id:"bulk_edit",user_info:{user_email:"",user_role:"",teams:[],models:[],max_budget:null,spend:0,metadata:{},created_at:null,updated_at:null},keys:[],teams:d||[]}),[d,e]),O=async e=>{if(console.log("formValues",e),!r)return void D.default.fromBackend("Access token not found");N(!0);try{let s=t.map(e=>e.user_id),a={};e.user_role&&""!==e.user_role&&(a.user_role=e.user_role),null!==e.max_budget&&void 0!==e.max_budget&&(a.max_budget=e.max_budget),e.models&&e.models.length>0&&(a.models=e.models),e.budget_duration&&""!==e.budget_duration&&(a.budget_duration=e.budget_duration),e.metadata&&Object.keys(e.metadata).length>0&&(a.metadata=e.metadata);let n=Object.keys(a).length>0,d=k&&S.length>0;if(!n&&!d)return void D.default.fromBackend("Please modify at least one field or select teams to add users to");let o=[];if(n)if(U){let e=await (0,b.userBulkUpdateUserCall)(r,a,void 0,!0);o.push(`Updated all users (${e.total_requested} total)`)}else await (0,b.userBulkUpdateUserCall)(r,a,s),o.push(`Updated ${s.length} user(s)`);if(d){let e=[];for(let s of S)try{let l=null;l=U?null:t.map(e=>({user_id:e.user_id,role:"user",user_email:e.user_email||null}));let a=await (0,b.teamBulkMemberAddCall)(r,s,l||null,w||void 0,U);console.log("result",a),e.push({teamId:s,success:!0,successfulAdditions:a.successful_additions,failedAdditions:a.failed_additions})}catch(l){console.error(`Failed to add users to team ${s}:`,l),e.push({teamId:s,success:!1,error:l})}let s=e.filter(e=>e.success),l=e.filter(e=>!e.success);if(s.length>0){let e=s.reduce((e,s)=>e+s.successfulAdditions,0);o.push(`Added users to ${s.length} team(s) (${e} total additions)`)}l.length>0&&x.message.warning(`Failed to add users to ${l.length} team(s)`)}o.length>0&&D.default.success(o.join(". ")),T([]),C(null),I(!1),R(!1),i(),l()}catch(e){console.error("Bulk operation failed:",e),D.default.fromBackend("Failed to perform bulk operations")}finally{N(!1)}};return(0,s.jsxs)(c.Modal,{open:e,onCancel:L,footer:null,title:U?"Bulk Edit All Users":`Bulk Edit ${t.length} User(s)`,width:800,children:[_&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)(y.Checkbox,{checked:U,onChange:e=>R(e.target.checked),children:(0,s.jsx)(F,{strong:!0,children:"Update ALL users in the system"})}),U&&(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(F,{type:"warning",style:{fontSize:"12px"},children:"âš ï¸ This will apply changes to ALL users in the system, not just the selected ones."})})]}),!U&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)(A,{level:5,children:["Selected Users (",t.length,"):"]}),(0,s.jsx)(h.Table,{size:"small",bordered:!0,dataSource:t,pagination:!1,scroll:{y:200},rowKey:"user_id",columns:[{title:"User ID",dataIndex:"user_id",key:"user_id",width:"30%",render:e=>(0,s.jsx)(F,{strong:!0,style:{fontSize:"12px"},children:e.length>20?`${e.slice(0,20)}...`:e})},{title:"Email",dataIndex:"user_email",key:"user_email",width:"25%",render:e=>(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:e||"No email"})},{title:"Current Role",dataIndex:"user_role",key:"user_role",width:"25%",render:e=>(0,s.jsx)(F,{style:{fontSize:"12px"},children:a?.[e]?.ui_label||e})},{title:"Budget",dataIndex:"max_budget",key:"max_budget",width:"20%",render:e=>(0,s.jsx)(F,{style:{fontSize:"12px"},children:null!==e?`$${e}`:"Unlimited"})}]})]}),(0,s.jsx)(m.Divider,{}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)(F,{children:[(0,s.jsx)("strong",{children:"Instructions:"})," Fill in the fields below with the values you want to apply to all selected users. You can bulk edit: role, budget, models, and metadata. You can also add users to teams."]})}),(0,s.jsx)(j.Card,{title:"Team Management",size:"small",className:"mb-4",style:{backgroundColor:"#fafafa"},children:(0,s.jsxs)(f.Space,{direction:"vertical",style:{width:"100%"},children:[(0,s.jsx)(y.Checkbox,{checked:k,onChange:e=>I(e.target.checked),children:"Add selected users to teams"}),k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{strong:!0,children:"Select Teams:"}),(0,s.jsx)(g.Select,{mode:"multiple",placeholder:"Select teams to add users to",value:S,onChange:T,style:{width:"100%",marginTop:8},options:d?.map(e=>({label:e.team_alias||e.team_id,value:e.team_id}))||[]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{strong:!0,children:"Team Budget (Optional):"}),(0,s.jsx)(p.InputNumber,{placeholder:"Max budget per user in team",value:w,onChange:e=>C(e),style:{width:"100%",marginTop:8},min:0,step:.01,precision:2}),(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:"Leave empty for unlimited budget within team limits"})]}),(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:'Users will be added with "user" role by default. All users will be added to each selected team.'})]})]})}),(0,s.jsx)(B,{userData:E,onCancel:L,onSubmit:O,teams:d,accessToken:r,userID:"bulk_edit",userRole:o,userModels:u,possibleUIRoles:a,isBulkEdit:!0}),v&&(0,s.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,s.jsxs)(F,{children:["Updating ",U?"all users":t.length," user(s)..."]})})]})};var L=e.i(371455),E=e.i(464571);let O=({visible:e,possibleUIRoles:l,onCancel:t,user:a,onSubmit:r})=>{let[i,d]=(0,n.useState)(a),[o]=T.Form.useForm();(0,n.useEffect)(()=>{o.resetFields()},[a]);let u=async()=>{o.resetFields(),t()},m=async e=>{r(e),o.resetFields(),t()};return a?(0,s.jsx)(c.Modal,{open:e,onCancel:u,footer:null,title:"Edit User "+a.user_id,width:1e3,children:(0,s.jsx)(T.Form,{form:o,onFinish:m,initialValues:a,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Form.Item,{className:"mt-8",label:"User Email",tooltip:"Email of the User",name:"user_email",children:(0,s.jsx)(N.TextInput,{})}),(0,s.jsx)(T.Form.Item,{label:"user_id",name:"user_id",hidden:!0,children:(0,s.jsx)(N.TextInput,{})}),(0,s.jsx)(T.Form.Item,{label:"User Role",name:"user_role",children:(0,s.jsx)(g.Select,{children:l&&Object.entries(l).map(([e,{ui_label:l,description:t}])=>(0,s.jsx)(v.SelectItem,{value:e,title:l,children:(0,s.jsxs)("div",{className:"flex",children:[l," ",(0,s.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:t})]})},e))})}),(0,s.jsx)(T.Form.Item,{label:"Spend (USD)",name:"spend",tooltip:"(float) - Spend of all LLM calls completed by this user",help:"Across all keys (including keys with team_id).",children:(0,s.jsx)(p.InputNumber,{min:0,step:.01})}),(0,s.jsx)(T.Form.Item,{label:"User Budget (USD)",name:"max_budget",tooltip:"(float) - Maximum budget of this user",help:"Maximum budget of this user.",children:(0,s.jsx)(U.default,{min:0,step:.01})}),(0,s.jsx)(T.Form.Item,{label:"Reset Budget",name:"budget_duration",children:(0,s.jsx)(k.default,{})}),(0,s.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,s.jsx)(E.Button,{htmlType:"submit",children:"Save"})}),(0,s.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,s.jsx)(E.Button,{htmlType:"submit",children:"Save"})})]})})}):null};var P=e.i(172372),M=e.i(500330),z=e.i(152473),K=e.i(266027),$=e.i(912598),V=e.i(127952),q=e.i(304967),G=e.i(629569),W=e.i(599724),J=e.i(114600),Q=e.i(482725),H=e.i(790848),Y=e.i(646563),X=e.i(955135);let Z=({accessToken:e,possibleUIRoles:l,userID:t,userRole:a})=>{let{t:r}=(0,d.useTranslation)(),[i,c]=(0,n.useState)(!0),[m,x]=(0,n.useState)(null),[h,j]=(0,n.useState)(!1),[f,y]=(0,n.useState)({}),[_,v]=(0,n.useState)(!1),[S,T]=(0,n.useState)([]),{Paragraph:w}=u.Typography,{Option:C}=g.Select;(0,n.useEffect)(()=>{(async()=>{if(!e)return c(!1);try{let s=await (0,b.getInternalUserSettings)(e);if(x(s),y(s.values||{}),e)try{let s=await (0,b.modelAvailableCall)(e,t,a);if(s&&s.data){let e=s.data.map(e=>e.id);T(e)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching SSO settings:",e),D.default.fromBackend("Failed to fetch SSO settings")}finally{c(!1)}})()},[e]);let U=async()=>{if(e){v(!0);try{let s=Object.entries(f).reduce((e,[s,l])=>(e[s]=""===l?null:l,e),{}),l=await (0,b.updateInternalUserSettings)(e,s);x({...m,values:l.settings}),j(!1)}catch(e){console.error("Error updating SSO settings:",e),D.default.fromBackend("Failed to update settings: "+e)}finally{v(!1)}}},B=(e,s)=>{y(l=>({...l,[e]:s}))},F=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?{team_id:e,user_role:"user"}:"object"==typeof e&&e.team_id?{team_id:e.team_id,max_budget_in_team:e.max_budget_in_team,user_role:e.user_role||"user"}:{team_id:"",user_role:"user"}):[];return i?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(Q.Spin,{size:"large"})}):m?(0,s.jsxs)(q.Card,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)(G.Title,{children:r("users.defaultUserSettings")}),!i&&m&&(h?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.Button,{variant:"secondary",onClick:()=>{j(!1),y(m.values||{})},disabled:_,children:"Cancel"}),(0,s.jsx)(o.Button,{onClick:U,loading:_,children:"Save Changes"})]}):(0,s.jsx)(o.Button,{onClick:()=>j(!0),children:r("users.editSettings")}))]}),m?.field_schema?.description&&(0,s.jsx)(w,{className:"mb-4",children:m.field_schema.description}),(0,s.jsx)(J.Divider,{}),(0,s.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:t}=m;return t&&t.properties?Object.entries(t.properties).map(([t,a])=>{let i=e[t],n=t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return(0,s.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,s.jsx)(W.Text,{className:"font-medium text-lg",children:n}),(0,s.jsx)(w,{className:"text-sm text-gray-500 mt-1",children:a.description||"No description available"}),h?(0,s.jsx)("div",{className:"mt-2",children:((e,t,a)=>{let i=t.type;if("teams"===e){let l,t;return(0,s.jsx)("div",{className:"mt-2",children:(l=F(f[e]||[]),t=(e,s,t)=>{let a=[...l];a[e]={...a[e],[s]:t},B("teams",a)},(0,s.jsxs)("div",{className:"space-y-3",children:[l.map((e,a)=>(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)(W.Text,{className:"font-medium",children:["Team ",a+1]}),(0,s.jsx)(o.Button,{size:"sm",variant:"secondary",icon:X.DeleteOutlined,onClick:()=>{B("teams",l.filter((e,s)=>s!==a))},className:"text-red-500 hover:text-red-700",children:"Remove"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"text-sm font-medium mb-1",children:r("users.teamId")}),(0,s.jsx)(N.TextInput,{value:e.team_id,onChange:e=>t(a,"team_id",e.target.value),placeholder:r("users.enterTeamId")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"text-sm font-medium mb-1",children:r("users.maxBudgetInTeam")}),(0,s.jsx)(p.InputNumber,{style:{width:"100%"},value:e.max_budget_in_team,onChange:e=>t(a,"max_budget_in_team",e),placeholder:r("common.optional"),min:0,step:.01,precision:2})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"text-sm font-medium mb-1",children:r("users.userRole")}),(0,s.jsxs)(g.Select,{style:{width:"100%"},value:e.user_role,onChange:e=>t(a,"user_role",e),children:[(0,s.jsx)(C,{value:"user",children:"User"}),(0,s.jsx)(C,{value:"admin",children:"Admin"})]})]})]})]},a)),(0,s.jsx)(o.Button,{variant:"secondary",icon:Y.PlusOutlined,onClick:()=>{B("teams",[...l,{team_id:"",user_role:"user"}])},className:"w-full",children:"Add Team"})]}))})}if("user_role"===e&&l)return(0,s.jsx)(g.Select,{style:{width:"100%"},value:f[e]||"",onChange:s=>B(e,s),className:"mt-2",children:Object.entries(l).filter(([e])=>e.includes("internal_user")).map(([e,{ui_label:l,description:t}])=>(0,s.jsx)(C,{value:e,children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{children:l}),(0,s.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:t})]})},e))});if("budget_duration"===e)return(0,s.jsx)(k.default,{value:f[e]||null,onChange:s=>B(e,s),className:"mt-2"});if("boolean"===i)return(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(H.Switch,{checked:!!f[e],onChange:s=>B(e,s)})});if("array"===i&&t.items?.enum)return(0,s.jsx)(g.Select,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:s=>B(e,s),className:"mt-2",children:t.items.enum.map(e=>(0,s.jsx)(C,{value:e,children:e},e))});else if("models"===e)return(0,s.jsxs)(g.Select,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:s=>B(e,s),className:"mt-2",children:[(0,s.jsx)(C,{value:"no-default-models",children:"No Default Models"},"no-default-models"),(0,s.jsx)(C,{value:"all-proxy-models",children:"All Proxy Models"},"all-proxy-models"),S.map(e=>(0,s.jsx)(C,{value:e,children:(0,I.getModelDisplayName)(e)},e))]});else if("string"===i&&t.enum)return(0,s.jsx)(g.Select,{style:{width:"100%"},value:f[e]||"",onChange:s=>B(e,s),className:"mt-2",children:t.enum.map(e=>(0,s.jsx)(C,{value:e,children:e},e))});else return(0,s.jsx)(N.TextInput,{value:void 0!==f[e]?String(f[e]):"",onChange:s=>B(e,s.target.value),placeholder:t.description||"",className:"mt-2"})})(t,a,0)}):(0,s.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:((e,t)=>{if(null==t)return(0,s.jsx)("span",{className:"text-gray-400",children:r("common.notSet")});if("teams"===e&&Array.isArray(t)){if(0===t.length)return(0,s.jsx)("span",{className:"text-gray-400",children:r("common.noTeamsAssigned")});let e=F(t);return(0,s.jsx)("div",{className:"space-y-2 mt-1",children:e.map((e,l)=>(0,s.jsx)("div",{className:"border rounded-lg p-3 bg-white",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-600",children:"Team ID:"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.team_id||"Not specified"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-600",children:"Max Budget:"}),(0,s.jsx)("p",{className:"text-gray-900",children:void 0!==e.max_budget_in_team?`$${(0,M.formatNumberWithCommas)(e.max_budget_in_team,4)}`:"No limit"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-600",children:"Role:"}),(0,s.jsx)("p",{className:"text-gray-900 capitalize",children:e.user_role})]})]})},l))})}if("user_role"===e&&l&&l[t]){let{ui_label:e,description:a}=l[t];return(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:e}),a&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:a})]})}if("budget_duration"===e)return(0,s.jsx)("span",{children:(0,k.getBudgetDurationLabel)(t)});if("boolean"==typeof t)return(0,s.jsx)("span",{children:t?"Enabled":"Disabled"});if("models"===e&&Array.isArray(t))return 0===t.length?(0,s.jsx)("span",{className:"text-gray-400",children:"None"}):(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:t.map((e,l)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,I.getModelDisplayName)(e)},l))});if("object"==typeof t)return Array.isArray(t)?0===t.length?(0,s.jsx)("span",{className:"text-gray-400",children:"None"}):(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:t.map((e,l)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},l))}):(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(t,null,2)});return(0,s.jsx)("span",{children:String(t)})})(t,i)})]},t)}):(0,s.jsx)(W.Text,{children:r("common.noSchemaInfo")})})()})]}):(0,s.jsx)(q.Card,{children:(0,s.jsx)(W.Text,{children:"No settings available or you do not have permission to view them."})})};var ee=e.i(389083),es=e.i(350967),el=e.i(752978),et=e.i(591935),ea=e.i(68155),er=e.i(502275),ei=e.i(278587);let en=(e,l,t,a,r,i)=>{let n=[{header:"User ID",accessorKey:"user_id",enableSorting:!0,cell:({row:e})=>(0,s.jsx)(w.Tooltip,{title:e.original.user_id,children:(0,s.jsx)("span",{className:"text-xs",children:e.original.user_id?`${e.original.user_id.slice(0,7)}...`:"-"})})},{header:"Email",accessorKey:"user_email",enableSorting:!0,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.user_email||"-"})},{header:"Global Proxy Role",accessorKey:"user_role",enableSorting:!0,cell:({row:l})=>(0,s.jsx)("span",{className:"text-xs",children:e?.[l.original.user_role]?.ui_label||"-"})},{header:"User Alias",accessorKey:"user_alias",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.user_alias||"-"})},{header:"Spend (USD)",accessorKey:"spend",enableSorting:!0,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.spend?(0,M.formatNumberWithCommas)(e.original.spend,4):"-"})},{header:"Budget (USD)",accessorKey:"max_budget",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:null!==e.original.max_budget?e.original.max_budget:"Unlimited"})},{header:()=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:"SSO ID"}),(0,s.jsx)(w.Tooltip,{title:"SSO ID is the ID of the user in the SSO provider. If the user is not using SSO, this will be null.",children:(0,s.jsx)(er.InformationCircleIcon,{className:"w-4 h-4"})})]}),accessorKey:"sso_user_id",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:null!==e.original.sso_user_id?e.original.sso_user_id:"-"})},{header:"Virtual Keys",accessorKey:"key_count",enableSorting:!1,cell:({row:e})=>(0,s.jsx)(es.Grid,{numItems:2,children:e.original.key_count>0?(0,s.jsxs)(ee.Badge,{size:"xs",color:"indigo",children:[e.original.key_count," ",1===e.original.key_count?"Key":"Keys"]}):(0,s.jsx)(ee.Badge,{size:"xs",color:"gray",children:"No Keys"})})},{header:"Created At",accessorKey:"created_at",enableSorting:!0,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.created_at?new Date(e.original.created_at).toLocaleDateString():"-"})},{header:"Updated At",accessorKey:"updated_at",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.updated_at?new Date(e.original.updated_at).toLocaleDateString():"-"})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:e})=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(w.Tooltip,{title:"Edit user details",children:(0,s.jsx)(el.Icon,{icon:et.PencilAltIcon,size:"sm",onClick:()=>r(e.original.user_id,!0),className:"cursor-pointer hover:text-blue-600"})}),(0,s.jsx)(w.Tooltip,{title:"Delete user",children:(0,s.jsx)(el.Icon,{icon:ea.TrashIcon,size:"sm",onClick:()=>t(e.original),className:"cursor-pointer hover:text-red-600"})}),(0,s.jsx)(w.Tooltip,{title:"Reset Password",children:(0,s.jsx)(el.Icon,{icon:ei.RefreshIcon,size:"sm",onClick:()=>a(e.original.user_id),className:"cursor-pointer hover:text-green-600"})})]})}];if(i){let{onSelectUser:e,onSelectAll:l,isUserSelected:t,isAllSelected:a,isIndeterminate:r}=i;return[{id:"select",enableSorting:!1,header:()=>(0,s.jsx)(y.Checkbox,{indeterminate:r,checked:a,onChange:e=>l(e.target.checked),onClick:e=>e.stopPropagation()}),cell:({row:l})=>(0,s.jsx)(y.Checkbox,{checked:t(l.original),onChange:s=>e(l.original,s.target.checked),onClick:e=>e.stopPropagation()})},...n]}return n};var ed=e.i(152990),eo=e.i(682830),ec=e.i(269200),eu=e.i(427612),em=e.i(64848),ex=e.i(942232),eh=e.i(496020),eg=e.i(977572),ep=e.i(206929),ej=e.i(94629),ef=e.i(360820),ey=e.i(871943),eb=e.i(981339),e_=e.i(530212),ev=e.i(118366),eN=e.i(678784);function eS({userId:e,onClose:d,accessToken:c,userRole:u,onDelete:m,possibleUIRoles:x,initialTab:h=0,startInEditMode:g=!1}){let[p,j]=(0,n.useState)(null),[f,y]=(0,n.useState)(!1),[_,v]=(0,n.useState)(!1),[N,S]=(0,n.useState)(!0),[T,w]=(0,n.useState)(g),[I,U]=(0,n.useState)([]),[F,A]=(0,n.useState)(!1),[R,L]=(0,n.useState)(null),[O,z]=(0,n.useState)(null),[K,$]=(0,n.useState)(h),[J,Q]=(0,n.useState)({}),[H,Y]=(0,n.useState)(!1);n.default.useEffect(()=>{z((0,b.getProxyBaseUrl)())},[]),n.default.useEffect(()=>{console.log(`userId: ${e}, userRole: ${u}, accessToken: ${c}`),(async()=>{try{if(!c)return;let s=await (0,b.userInfoCall)(c,e,u||"",!1,null,null,!0);j(s);let l=(await (0,b.modelAvailableCall)(c,e,u||"")).data.map(e=>e.id);U(l)}catch(e){console.error("Error fetching user data:",e),D.default.fromBackend("Failed to fetch user data")}finally{S(!1)}})()},[c,e,u]);let X=async()=>{if(!c)return void D.default.fromBackend("Access token not found");try{D.default.success("Generating password reset link...");let s=await (0,b.invitationCreateCall)(c,e);L(s),A(!0)}catch(e){D.default.fromBackend("Failed to generate password reset link")}},Z=async()=>{try{if(!c)return;v(!0),await (0,b.userDeleteCall)(c,[e]),D.default.success("User deleted successfully"),m&&m(),d()}catch(e){console.error("Error deleting user:",e),D.default.fromBackend("Failed to delete user")}finally{y(!1),v(!1)}},el=async e=>{try{if(!c||!p)return;await (0,b.userUpdateUserCall)(c,e,null),j({...p,user_info:{...p.user_info,user_email:e.user_email,user_alias:e.user_alias,models:e.models,max_budget:e.max_budget,budget_duration:e.budget_duration,metadata:e.metadata}}),D.default.success("User updated successfully"),w(!1)}catch(e){console.error("Error updating user:",e),D.default.fromBackend("Failed to update user")}};if(N)return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(o.Button,{icon:e_.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,s.jsx)(W.Text,{children:"Loading user data..."})]});if(!p)return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(o.Button,{icon:e_.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,s.jsx)(W.Text,{children:"User not found"})]});let et=async(e,s)=>{await (0,M.copyToClipboard)(e)&&(Q(e=>({...e,[s]:!0})),setTimeout(()=>{Q(e=>({...e,[s]:!1}))},2e3))};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.Button,{icon:e_.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,s.jsx)(G.Title,{children:p.user_info?.user_email||"User"}),(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)(W.Text,{className:"text-gray-500 font-mono",children:p.user_id}),(0,s.jsx)(E.Button,{type:"text",size:"small",icon:J["user-id"]?(0,s.jsx)(eN.CheckIcon,{size:12}):(0,s.jsx)(ev.CopyIcon,{size:12}),onClick:()=>et(p.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${J["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),u&&C.rolesWithWriteAccess.includes(u)&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.Button,{icon:ei.RefreshIcon,variant:"secondary",onClick:X,className:"flex items-center",children:"Reset Password"}),(0,s.jsx)(o.Button,{icon:ea.TrashIcon,variant:"secondary",onClick:()=>y(!0),className:"flex items-center text-red-500 border-red-500 hover:text-red-600 hover:border-red-600",children:"Delete User"})]})]}),(0,s.jsx)(V.default,{isOpen:f,title:"Delete User?",message:"Are you sure you want to delete this user? This action cannot be undone.",resourceInformationTitle:"User Information",resourceInformation:[{label:"Email",value:p.user_info?.user_email},{label:"User ID",value:p.user_id,code:!0},{label:"Global Proxy Role",value:p.user_info?.user_role&&x?.[p.user_info.user_role]?.ui_label||p.user_info?.user_role||"-"},{label:"Total Spend (USD)",value:p.user_info?.spend!==null&&p.user_info?.spend!==void 0?p.user_info.spend.toFixed(2):void 0}],onCancel:()=>{y(!1)},onOk:Z,confirmLoading:_}),(0,s.jsxs)(t.TabGroup,{defaultIndex:K,onIndexChange:$,children:[(0,s.jsxs)(a.TabList,{className:"mb-4",children:[(0,s.jsx)(l.Tab,{children:"Overview"}),(0,s.jsx)(l.Tab,{children:"Details"})]}),(0,s.jsxs)(i.TabPanels,{children:[(0,s.jsx)(r.TabPanel,{children:(0,s.jsxs)(es.Grid,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(W.Text,{children:"Spend"}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)(G.Title,{children:["$",(0,M.formatNumberWithCommas)(p.user_info?.spend||0,4)]}),(0,s.jsxs)(W.Text,{children:["of"," ",p.user_info?.max_budget!==null?`$${(0,M.formatNumberWithCommas)(p.user_info.max_budget,4)}`:"Unlimited"]})]})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(W.Text,{children:"Teams"}),(0,s.jsx)("div",{className:"mt-2",children:p.teams?.length&&p.teams?.length>0?(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[p.teams?.slice(0,H?p.teams.length:20).map((e,l)=>(0,s.jsx)(ee.Badge,{color:"blue",title:e.team_alias,children:e.team_alias},l)),!H&&p.teams?.length>20&&(0,s.jsxs)(ee.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!0),children:["+",p.teams.length-20," more"]}),H&&p.teams?.length>20&&(0,s.jsx)(ee.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!1),children:"Show Less"})]}):(0,s.jsx)(W.Text,{children:"No teams"})})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(W.Text,{children:"Virtual Keys"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)(W.Text,{children:[p.keys?.length||0," ",p.keys?.length===1?"Key":"Keys"]})})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(W.Text,{children:"Personal Models"}),(0,s.jsx)("div",{className:"mt-2",children:p.user_info?.models?.length&&p.user_info?.models?.length>0?p.user_info?.models?.map((e,l)=>(0,s.jsx)(W.Text,{children:e},l)):(0,s.jsx)(W.Text,{children:"All proxy models"})})]})]})}),(0,s.jsx)(r.TabPanel,{children:(0,s.jsxs)(q.Card,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)(G.Title,{children:"User Settings"}),!T&&u&&C.rolesWithWriteAccess.includes(u)&&(0,s.jsx)(o.Button,{onClick:()=>w(!0),children:"Edit Settings"})]}),T&&p?(0,s.jsx)(B,{userData:p,onCancel:()=>w(!1),onSubmit:el,teams:p.teams,accessToken:c,userID:e,userRole:u,userModels:I,possibleUIRoles:x}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"User ID"}),(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)(W.Text,{className:"font-mono",children:p.user_id}),(0,s.jsx)(E.Button,{type:"text",size:"small",icon:J["user-id"]?(0,s.jsx)(eN.CheckIcon,{size:12}):(0,s.jsx)(ev.CopyIcon,{size:12}),onClick:()=>et(p.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${J["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Email"}),(0,s.jsx)(W.Text,{children:p.user_info?.user_email||"Not Set"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"User Alias"}),(0,s.jsx)(W.Text,{children:p.user_info?.user_alias||"Not Set"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Global Proxy Role"}),(0,s.jsx)(W.Text,{children:p.user_info?.user_role||"Not Set"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Created"}),(0,s.jsx)(W.Text,{children:p.user_info?.created_at?new Date(p.user_info.created_at).toLocaleString():"Unknown"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Last Updated"}),(0,s.jsx)(W.Text,{children:p.user_info?.updated_at?new Date(p.user_info.updated_at).toLocaleString():"Unknown"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Teams"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:p.teams?.length&&p.teams?.length>0?(0,s.jsxs)(s.Fragment,{children:[p.teams?.slice(0,H?p.teams.length:20).map((e,l)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",title:e.team_alias||e.team_id,children:e.team_alias||e.team_id},l)),!H&&p.teams?.length>20&&(0,s.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!0),children:["+",p.teams.length-20," more"]}),H&&p.teams?.length>20&&(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!1),children:"Show Less"})]}):(0,s.jsx)(W.Text,{children:"No teams"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Personal Models"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:p.user_info?.models?.length&&p.user_info?.models?.length>0?p.user_info?.models?.map((e,l)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:e},l)):(0,s.jsx)(W.Text,{children:"All proxy models"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Virtual Keys"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:p.keys?.length&&p.keys?.length>0?p.keys.map((e,l)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:e.key_alias||e.token},l)):(0,s.jsx)(W.Text,{children:"No Virtual Keys"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Max Budget"}),(0,s.jsx)(W.Text,{children:p.user_info?.max_budget!==null&&p.user_info?.max_budget!==void 0?`$${(0,M.formatNumberWithCommas)(p.user_info.max_budget,4)}`:"Unlimited"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Budget Reset"}),(0,s.jsx)(W.Text,{children:(0,k.getBudgetDurationLabel)(p.user_info?.budget_duration??null)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(W.Text,{className:"font-medium",children:"Metadata"}),(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(p.user_info?.metadata||{},null,2)})]})]})]})})]})]}),(0,s.jsx)(P.default,{isInvitationLinkModalVisible:F,setIsInvitationLinkModalVisible:A,baseUrl:O||"",invitationLinkData:R,modalType:"resetPassword"})]})}var eT=e.i(655913),ew=e.i(38419),eC=e.i(78334),ek=e.i(555436),eI=e.i(284614);let eU=(0,e.i(475254).default)("circle-user-round",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function eB({data:e=[],columns:l,isLoading:t=!1,onSortChange:a,currentSort:r,accessToken:i,userRole:d,possibleUIRoles:o,handleEdit:c,handleDelete:u,handleResetPassword:m,selectedUsers:x=[],onSelectionChange:h,enableSelection:g=!1,filters:p,updateFilters:j,initialFilters:f,teams:y,userListResponse:b,currentPage:_,handlePageChange:N}){let[S,T]=n.default.useState([{id:r?.sortBy||"created_at",desc:r?.sortOrder==="desc"}]),[w,C]=n.default.useState(null),[k,I]=n.default.useState(!1),[U,B]=n.default.useState(!1),D=(e,s=!1)=>{C(e),I(s)},F=(e,s)=>{h&&(s?h([...x,e]):h(x.filter(s=>s.user_id!==e.user_id)))},A=s=>{h&&(s?h(e):h([]))},R=e=>x.some(s=>s.user_id===e.user_id),L=e.length>0&&x.length===e.length,E=x.length>0&&x.length<e.length,O=n.default.useMemo(()=>o?en(o,c,u,m,D,g?{selectedUsers:x,onSelectUser:F,onSelectAll:A,isUserSelected:R,isAllSelected:L,isIndeterminate:E}:void 0):l,[o,c,u,m,D,l,g,x,L,E]),P=(0,ed.useReactTable)({data:e,columns:O,state:{sorting:S},onSortingChange:e=>{let s="function"==typeof e?e(S):e;if(T(s),s&&Array.isArray(s)&&s.length>0&&s[0]){let e=s[0];if(e.id){let s=e.id,l=e.desc?"desc":"asc";a?.(s,l)}}else a?.("created_at","desc")},getCoreRowModel:(0,eo.getCoreRowModel)(),manualSorting:!0,enableSorting:!0});return(n.default.useEffect(()=>{r&&T([{id:r.sortBy,desc:"desc"===r.sortOrder}])},[r]),w)?(0,s.jsx)(eS,{userId:w,onClose:()=>{C(null),I(!1)},accessToken:i,userRole:d,possibleUIRoles:o,initialTab:+!!k,startInEditMode:k}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"border-b px-6 py-4",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsx)(eT.FilterInput,{placeholder:"Search by email...",value:p.email,onChange:e=>j({email:e}),icon:ek.Search}),(0,s.jsx)(ew.FiltersButton,{onClick:()=>B(!U),active:U,hasActiveFilters:!!(p.user_id||p.user_role||p.team)}),(0,s.jsx)(eC.ResetFiltersButton,{onClick:()=>{j(f)}})]}),U&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,s.jsx)(eT.FilterInput,{placeholder:"Filter by User ID",value:p.user_id,onChange:e=>j({user_id:e}),icon:eI.User}),(0,s.jsx)(eT.FilterInput,{placeholder:"Filter by SSO ID",value:p.sso_user_id,onChange:e=>j({sso_user_id:e}),icon:eU}),(0,s.jsx)("div",{className:"w-64",children:(0,s.jsx)(ep.Select,{value:p.user_role,onValueChange:e=>j({user_role:e}),placeholder:"Select Role",children:o&&Object.entries(o).map(([e,l])=>(0,s.jsx)(v.SelectItem,{value:e,children:l.ui_label},e))})}),(0,s.jsx)("div",{className:"w-64",children:(0,s.jsx)(ep.Select,{value:p.team,onValueChange:e=>j({team:e}),placeholder:"Select Team",children:y?.map(e=>(0,s.jsx)(v.SelectItem,{value:e.team_id,children:e.team_alias||e.team_id},e.team_id))})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[t?(0,s.jsx)(eb.Skeleton.Input,{active:!0,style:{width:192,height:20}}):(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Showing"," ",b&&b.users&&b.users.length>0?(b.page-1)*b.page_size+1:0," ","-"," ",b&&b.users?Math.min(b.page*b.page_size,b.total):0," ","of ",b?b.total:0," results"]}),(0,s.jsx)("div",{className:"flex space-x-2",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eb.Skeleton.Button,{active:!0,size:"small",style:{width:80,height:30}}),(0,s.jsx)(eb.Skeleton.Button,{active:!0,size:"small",style:{width:60,height:30}})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>N(_-1),disabled:1===_,className:`px-3 py-1 text-sm border rounded-md ${1===_?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),(0,s.jsx)("button",{onClick:()=>N(_+1),disabled:!b||_>=b.total_pages,className:`px-3 py-1 text-sm border rounded-md ${!b||_>=b.total_pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})})]})]})}),(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(ec.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,s.jsx)(eu.TableHead,{children:P.getHeaderGroups().map(e=>(0,s.jsx)(eh.TableRow,{children:e.headers.map(e=>(0,s.jsx)(em.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""} ${e.column.getCanSort()?"cursor-pointer hover:bg-gray-50":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,ed.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(ef.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(ey.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(ej.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,s.jsx)(ex.TableBody,{children:t?(0,s.jsx)(eh.TableRow,{children:(0,s.jsx)(eg.TableCell,{colSpan:O.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"ðŸš… Loading users..."})})})}):e.length>0?P.getRowModel().rows.map(e=>(0,s.jsx)(eh.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(eg.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:()=>{"user_id"===e.column.id&&D(e.getValue(),!1)},style:{cursor:"user_id"===e.column.id?"pointer":"default",color:"user_id"===e.column.id?"#3b82f6":"inherit"},children:(0,ed.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(eh.TableRow,{children:(0,s.jsx)(eg.TableCell,{colSpan:O.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"No users found"})})})})})]})})})})]})}let{Text:eD,Title:eF}=u.Typography,eA={email:"",user_id:"",user_role:"",sso_user_id:"",team:"",model:"",min_spend:null,max_spend:null,sort_by:"created_at",sort_order:"desc"};e.s(["default",0,({accessToken:e,token:c,userRole:u,userID:m,teams:x})=>{let{t:h}=(0,d.useTranslation)(),g=(0,$.useQueryClient)(),[p,j]=(0,n.useState)(1),[f,y]=(0,n.useState)(!1),[_,v]=(0,n.useState)(null),[N,S]=(0,n.useState)(!1),[T,w]=(0,n.useState)(!1),[k,I]=(0,n.useState)(null),[U,B]=(0,n.useState)("users"),[F,A]=(0,n.useState)(eA),[E,q,G]=(0,z.useDebouncedState)(F,{wait:300}),[W,J]=(0,n.useState)(!1),[Q,H]=(0,n.useState)(null),[Y,X]=(0,n.useState)(null),[ee,es]=(0,n.useState)([]),[el,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!1),[ei,ed]=(0,n.useState)([]),eo=e=>{I(e),S(!0)};(0,n.useEffect)(()=>()=>{G.cancel()},[G]),(0,n.useEffect)(()=>{X((0,b.getProxyBaseUrl)())},[]),(0,n.useEffect)(()=>{(async()=>{try{if(!m||!u||!e)return;let s=(await (0,b.modelAvailableCall)(e,m,u)).data.map(e=>e.id);console.log("available_model_names:",s),ed(s)}catch(e){console.error("Error fetching user models:",e)}})()},[e,m,u]);let ec=e=>{A(s=>{let l={...s,...e};return q(l),l})},eu=async s=>{if(!e)return void D.default.fromBackend(h("users.accessTokenNotFound"));try{D.default.success(h("users.generatingPasswordResetLink"));let l=await (0,b.invitationCreateCall)(e,s);H(l),J(!0)}catch(e){D.default.fromBackend(h("users.failedToGeneratePasswordResetLink"))}},em=async()=>{if(k&&e)try{w(!0),await (0,b.userDeleteCall)(e,[k.user_id]),g.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.filter(e=>e.user_id!==k.user_id);return{...e,users:s}}),D.default.success(h("users.userDeletedSuccess"))}catch(e){console.error("Error deleting user:",e),D.default.fromBackend(h("users.failedToDeleteUser"))}finally{S(!1),I(null),w(!1)}},ex=async()=>{v(null),y(!1)},eh=async s=>{if(console.log("inside handleEditSubmit:",s),e&&c&&u&&m){try{let l=await (0,b.userUpdateUserCall)(e,s,null);g.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.map(e=>e.user_id===l.data.user_id?(0,M.updateExistingKeys)(e,l.data):e);return{...e,users:s}}),D.default.success(h("users.userUpdatedSuccess",{userId:s.user_id}))}catch(e){console.error(h("users.errorUpdatingUser"),e)}v(null),y(!1)}},eg=async e=>{j(e)},ep=(0,K.useQuery)({queryKey:["userList",{debouncedFilter:E,currentPage:p}],queryFn:async()=>{if(!e)throw Error("Access token required");return await (0,b.userListCall)(e,E.user_id?[E.user_id]:null,p,25,E.email||null,E.user_role||null,E.team||null,E.sso_user_id||null,E.sort_by,E.sort_order)},enabled:!!(e&&c&&u&&m),placeholderData:e=>e}),ej=ep.data,ef=(0,K.useQuery)({queryKey:["userRoles"],initialData:()=>({}),queryFn:async()=>{if(!e)throw Error("Access token required");return await (0,b.getPossibleUserRoles)(e)},enabled:!!(e&&c&&u&&m)}).data,ey=en(ef,e=>{v(e),y(!0)},eo,eu,()=>{});return(0,s.jsxs)("div",{className:"w-full p-8 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"flex space-x-3",children:ep.isLoading?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eb.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}}),(0,s.jsx)(eb.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:145,height:36}}),(0,s.jsx)(eb.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}})]}):m&&e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.CreateUserButton,{userID:m,accessToken:e,teams:x,possibleUIRoles:ef}),(0,s.jsx)(o.Button,{onClick:()=>{er(!ea),es([])},variant:ea?"primary":"secondary",className:"flex items-center",children:ea?h("users.cancelSelection"):h("users.selectUsers")}),ea&&(0,s.jsx)(o.Button,{onClick:()=>{0===ee.length?D.default.fromBackend(h("users.pleaseSelectUsers")):et(!0)},disabled:0===ee.length,className:"flex items-center",children:h("users.bulkEdit",{count:ee.length})})]}):null})}),(0,s.jsxs)(t.TabGroup,{defaultIndex:0,onIndexChange:e=>B(0===e?"users":"settings"),children:[(0,s.jsxs)(a.TabList,{className:"mb-4",children:[(0,s.jsx)(l.Tab,{children:h("users.users")}),(0,s.jsx)(l.Tab,{children:h("users.defaultUserSettings")})]}),(0,s.jsxs)(i.TabPanels,{children:[(0,s.jsx)(r.TabPanel,{children:(0,s.jsx)(eB,{data:ep.data?.users||[],columns:ey,isLoading:ep.isLoading,accessToken:e,userRole:u,onSortChange:(e,s)=>{ec({sort_by:e,sort_order:s})},currentSort:{sortBy:F.sort_by,sortOrder:F.sort_order},possibleUIRoles:ef,handleEdit:e=>{v(e),y(!0)},handleDelete:eo,handleResetPassword:eu,enableSelection:ea,selectedUsers:ee,onSelectionChange:e=>{es(e)},filters:F,updateFilters:ec,initialFilters:eA,teams:x,userListResponse:ej,currentPage:p,handlePageChange:eg})}),(0,s.jsx)(r.TabPanel,{children:m&&u&&e?(0,s.jsx)(Z,{accessToken:e,possibleUIRoles:ef,userID:m,userRole:u}):(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(eb.Skeleton,{active:!0,paragraph:{rows:4}})})})]})]}),(0,s.jsx)(O,{visible:f,possibleUIRoles:ef,onCancel:ex,user:_,onSubmit:eh}),(0,s.jsx)(V.default,{isOpen:N,title:h("users.deleteUserConfirm"),message:h("users.deleteUserMessage"),resourceInformationTitle:h("users.userInformation"),resourceInformation:[{label:h("users.email"),value:k?.user_email},{label:h("users.userId"),value:k?.user_id,code:!0},{label:h("users.globalProxyRole"),value:k&&ef?.[k.user_role]?.ui_label||k?.user_role||"-"},{label:h("users.totalSpendUSD"),value:k?.spend?.toFixed(2)}],onCancel:()=>{S(!1),I(null)},onOk:em,confirmLoading:T}),(0,s.jsx)(P.default,{isInvitationLinkModalVisible:W,setIsInvitationLinkModalVisible:J,baseUrl:Y||"",invitationLinkData:Q,modalType:"resetPassword"}),(0,s.jsx)(R,{open:el,onCancel:()=>et(!1),selectedUsers:ee,possibleUIRoles:ef,accessToken:e,onSuccess:()=>{g.invalidateQueries({queryKey:["userList"]}),es([]),er(!1)},teams:x,userRole:u,userModels:ei,allowAllUsers:!!u&&(0,C.isAdminRole)(u)})]})}],910119)}]);